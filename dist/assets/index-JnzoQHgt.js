import{g as N,d as $,u as P,c as F}from"./users-Chko-4zv.js";import{d as L,r as p,a as R,s as j,q as z,c as A,b as y,v as O,e as l,w as o,f as u,x as Z,m as h,o as T,g as m,t as G,y as J,E as c}from"./index-CYHUCKG_.js";import{_ as K}from"./_plugin-vue_export-helper-COv-dAod.js";const Q={class:"users-container"},W={class:"header"},X=L({__name:"index",setup(ee){const _=p(!1),n=p(!1),b=p(!1),s=p(!1),k=p([]),f=p(),t=R({username:"",password:"",userToken:"",longitude:"",latitude:"",vipExpireTime:""}),w=j(()=>({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!s.value,message:"请输入密码",trigger:"blur"}],userToken:[{required:!0,message:"请输入用户Token",trigger:"blur"}],longitude:[{required:!0,message:"请输入经度",trigger:"blur"}],latitude:[{required:!0,message:"请输入纬度",trigger:"blur"}],vipExpireTime:[{required:!0,message:"请选择VIP到期时间",trigger:"blur"}]})),V=async()=>{_.value=!0;try{k.value=await N()}catch(r){console.error("获取用户列表失败:",r)}finally{_.value=!1}},x=()=>{f.value&&f.value.resetFields(),t.username="",t.password="",t.userToken="",t.longitude="",t.latitude="",t.vipExpireTime=""},E=()=>{s.value=!1,x(),n.value=!0},U=r=>{s.value=!0,Object.assign(t,{...r,password:""}),n.value=!0},C=r=>{J.confirm(`确认删除用户 "${r.username}" 吗？`,"警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await $(r.username),c.success("删除成功"),V()}catch(e){console.error("删除用户失败:",e)}})},D=async()=>{f.value&&await f.value.validate(async r=>{if(r){b.value=!0;try{if(s.value){const e={...t};e.password||delete e.password,await P(t.username,e),c.success("更新成功")}else await F(t),c.success("创建成功");n.value=!1,V()}catch(e){c.error(e.message||(s.value?"更新失败":"创建失败"))}finally{b.value=!1}}})},Y=r=>new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return z(()=>{V()}),(r,e)=>{const v=u("el-button"),i=u("el-table-column"),q=u("el-table"),g=u("el-input"),d=u("el-form-item"),B=u("el-date-picker"),M=u("el-form"),S=u("el-dialog"),H=Z("loading");return T(),A("div",Q,[y("div",W,[e[9]||(e[9]=y("h2",null,"用户管理",-1)),l(v,{type:"primary",onClick:E},{default:o(()=>e[8]||(e[8]=[m(" 新增用户 ")])),_:1})]),O((T(),h(q,{data:k.value,border:"",style:{width:"100%"}},{default:o(()=>[l(i,{prop:"username",label:"用户名"}),l(i,{prop:"userToken",label:"用户Token"}),l(i,{prop:"longitude",label:"经度"}),l(i,{prop:"latitude",label:"纬度"}),l(i,{prop:"vipExpireTime",label:"VIP到期时间"},{default:o(({row:a})=>[m(G(Y(a.vipExpireTime)),1)]),_:1}),l(i,{label:"操作",width:"200"},{default:o(({row:a})=>[l(v,{type:"primary",link:"",onClick:I=>U(a)},{default:o(()=>e[10]||(e[10]=[m(" 编辑 ")])),_:2},1032,["onClick"]),l(v,{type:"danger",link:"",onClick:I=>C(a)},{default:o(()=>e[11]||(e[11]=[m(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,_.value]]),l(S,{modelValue:n.value,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value=a),title:s.value?"编辑用户":"新增用户",width:"500px"},{footer:o(()=>[l(v,{onClick:e[6]||(e[6]=a=>n.value=!1)},{default:o(()=>e[12]||(e[12]=[m("取消")])),_:1}),l(v,{type:"primary",onClick:D,loading:b.value},{default:o(()=>e[13]||(e[13]=[m(" 确认 ")])),_:1},8,["loading"])]),default:o(()=>[l(M,{ref_key:"formRef",ref:f,model:t,rules:w.value,"label-width":"100px"},{default:o(()=>[l(d,{label:"用户名",prop:"username"},{default:o(()=>[l(g,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=a=>t.username=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"密码",prop:"password",rules:s.value?[]:w.value.password},{default:o(()=>[l(g,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.password=a),type:"password","show-password":"",placeholder:s.value?"不修改请留空":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1},8,["rules"]),l(d,{label:"用户Token",prop:"userToken"},{default:o(()=>[l(g,{modelValue:t.userToken,"onUpdate:modelValue":e[2]||(e[2]=a=>t.userToken=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"经度",prop:"longitude"},{default:o(()=>[l(g,{modelValue:t.longitude,"onUpdate:modelValue":e[3]||(e[3]=a=>t.longitude=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"纬度",prop:"latitude"},{default:o(()=>[l(g,{modelValue:t.latitude,"onUpdate:modelValue":e[4]||(e[4]=a=>t.latitude=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"VIP到期时间",prop:"vipExpireTime"},{default:o(()=>[l(B,{modelValue:t.vipExpireTime,"onUpdate:modelValue":e[5]||(e[5]=a=>t.vipExpireTime=a),type:"datetime",placeholder:"选择日期时间","value-format":"YYYY-MM-DDTHH:mm:ss.SSSZ",format:"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),oe=K(X,[["__scopeId","data-v-1335f517"]]);export{oe as default};
